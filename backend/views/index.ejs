<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2563eb">
    <title>Kinnect</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/index.css">
</head>
<body data-user-id="<%= authUser && authUser.id ? authUser.id : '' %>" data-display-name="<%= typeof displayName !== 'undefined' ? displayName : '' %>" data-role="<%= authUser && authUser.role ? authUser.role : '' %>">
    <noscript><div style="padding:2rem;text-align:center;font-family:var(--font-sans);"><h2>JavaScript Required</h2><p>This app requires JavaScript to function. Please enable it in your browser settings.</p></div></noscript>

    <!-- ═══ Loading Overlay ═══════════════════════════════════════════════ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="10" r="3"/><path d="M12 2a8 8 0 0 0-8 8c0 1.892.402 3.13 1.5 4.5L12 22l6.5-7.5c1.098-1.37 1.5-2.608 1.5-4.5a8 8 0 0 0-8-8z"/></svg>
        </div>
        <div class="loading-spinner-ring"></div>
        <div class="loading-text">Connecting...</div>
    </div>

    <!-- ═══ Enable Alerts Overlay ═════════════════════════════════════════ -->
    <div class="enable-alerts-overlay" id="enableAlertsOverlay">
        <div class="enable-alerts-card card">
            <div class="enable-alerts-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            </div>
            <h2>Enable Alerts</h2>
            <p class="text-muted">This app uses sound and vibration for SOS and safety check-ins.</p>
            <p class="text-muted">Tap "Enable Alerts" once so your browser allows audio.</p>
            <div class="enable-alerts-actions">
                <button class="btn btn-primary" id="enableAlertsBtn" type="button" aria-label="Enable sound and vibration alerts">Enable Alerts</button>
                <button class="btn btn-secondary" id="skipAlertsBtn" type="button" aria-label="Continue without sound alerts">Continue without sound</button>
            </div>
        </div>
    </div>

    <!-- ═══ Status Banner (Toast) ═════════════════════════════════════════ -->
    <div class="status-banner" id="statusBanner">
        <div class="status-banner-content">
            <div id="statusText"></div>
            <div class="status-actions" id="statusActions"></div>
        </div>
        <div class="status-banner-progress"></div>
    </div>

    <!-- ═══ Alert Overlay (SOS / Check-in) ════════════════════════════════ -->
    <div class="alert-overlay" id="alertOverlay">
        <div class="alert-card">
            <h2 id="alertTitle">SOS Alert</h2>
            <div id="alertBody" class="text-sm"></div>
            <div class="status-actions" id="alertActions" style="margin-top:var(--space-3);"></div>
        </div>
    </div>

    <!-- ═══ Top Navigation Bar ════════════════════════════════════════════ -->
    <nav class="navbar" id="navbar">
        <div class="navbar-left">
            <div class="navbar-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="10" r="3"/><path d="M12 2a8 8 0 0 0-8 8c0 1.892.402 3.13 1.5 4.5L12 22l6.5-7.5c1.098-1.37 1.5-2.608 1.5-4.5a8 8 0 0 0-8-8z"/></svg>
            </div>
            <span class="navbar-title">Kinnect</span>
        </div>

        <div class="navbar-center">
            <button class="sos-button" id="sosBtn" type="button" data-active="0" aria-label="Trigger SOS emergency alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                SOS
            </button>
        </div>

        <div class="navbar-right">
            <button class="btn btn-ghost btn-icon nav-toggle" id="alertsSettingsBtn" type="button" aria-label="Open alerts settings" title="Alerts">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            </button>
            <button class="btn btn-ghost btn-icon nav-toggle" id="sharePanelBtn" type="button" aria-label="Toggle sharing panel" title="Sharing">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            </button>
            <button class="btn btn-ghost btn-icon nav-toggle" id="infoPanelBtn" type="button" aria-label="Toggle info panel" title="Info">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            </button>
            <button class="btn btn-ghost btn-icon nav-toggle" id="usersPanelBtn" type="button" aria-label="Toggle users panel" title="Users">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            </button>
            <% if (authUser && authUser.role === 'admin') { %>
            <button class="btn btn-ghost btn-icon nav-toggle" id="adminPanelBtn" type="button" aria-label="Toggle admin panel" title="Admin">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
            <% } %>
            <button class="btn btn-ghost btn-icon nav-toggle" id="themeToggleBtn" type="button" aria-label="Toggle dark mode" title="Theme">
                <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
            </button>
            <div class="navbar-avatar" id="navAvatar" title="<%= typeof displayName !== 'undefined' ? displayName : '' %>">
                <%= typeof displayName !== 'undefined' ? displayName.charAt(0).toUpperCase() : '?' %>
            </div>
        </div>
    </nav>

    <!-- ═══ Map ═══════════════════════════════════════════════════════════ -->
    <div id="map"></div>

    <!-- ═══ Info Panel (Right) ════════════════════════════════════════════ -->
    <div class="panel panel-right" id="infoPanel">
        <div class="panel-header">
            <div class="panel-title">Info</div>
            <button class="btn btn-ghost btn-icon btn-sm panel-close" type="button" aria-label="Close info panel" data-close="info">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div class="panel-body">
            <!-- User identity -->
            <div class="user-identity">
                <div class="avatar avatar-lg"><%= typeof displayName !== 'undefined' ? displayName.charAt(0).toUpperCase() : '?' %></div>
                <div class="user-identity-meta">
                    <div class="font-semibold"><%= typeof displayName !== 'undefined' ? displayName : '' %></div>
                    <div class="text-sm text-muted">
                        <%= authUser.role === 'admin' ? 'Admin' : 'Member' %>
                    </div>
                </div>
                <form method="POST" action="/logout" style="margin-left:auto;">
                    <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
                    <button class="btn btn-secondary btn-sm" type="submit" aria-label="Log out">Logout</button>
                </form>
            </div>

            <hr class="divider">

            <!-- Quick actions -->
            <div class="quick-actions">
                <button class="btn btn-primary btn-sm" id="imOkBtn" type="button" aria-label="Send I'm OK check-in">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                    I'm OK
                </button>
                <label class="toggle">
                    <input type="checkbox" id="keep48Toggle">
                    <span class="toggle-track"></span>
                    <span>Keep location 48h</span>
                </label>
            </div>

            <hr class="divider">

            <!-- Location metrics -->
            <div class="section-label">Your Location</div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Latitude</div>
                    <div class="metric-value" id="latitude">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Longitude</div>
                    <div class="metric-value" id="longitude">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Speed</div>
                    <div class="metric-value"><span id="speed">-</span> <span class="text-xs text-muted">km/h</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Distance</div>
                    <div class="metric-value"><span id="distance">0</span> <span class="text-xs text-muted">m</span></div>
                </div>
            </div>
            <div class="text-xs text-muted" style="margin-top:var(--space-2);">Last Updated: <span id="timestamp">-</span></div>

            <% if (authUser && authUser.role === 'admin') { %>
            <hr class="divider">
            <!-- Admin Panel -->
            <div id="adminPanel">
                <div class="section-label" style="display:flex;align-items:center;justify-content:space-between;">
                    Admin Controls
                    <span class="badge badge-success">Admin</span>
                </div>
                <div class="panel-body" id="adminPanelBody">
                    <!-- Target selector -->
                    <div class="admin-field">
                        <label class="label">Apply to</label>
                        <select id="adminTargetSelect" class="select" aria-label="Select target user"></select>
                    </div>
                    <!-- Auto-SOS -->
                    <div class="admin-group">
                        <label class="toggle">
                            <input type="checkbox" id="autoSosToggle">
                            <span class="toggle-track"></span>
                            <span>Auto-SOS</span>
                        </label>
                        <div class="admin-inputs">
                            <div class="admin-field">
                                <label class="label">No-move (min)</label>
                                <input id="autoNoMoveMin" type="number" min="1" step="1" value="5" class="input" aria-label="No movement minutes threshold" />
                            </div>
                            <div class="admin-field">
                                <label class="label">Hard-stop (min)</label>
                                <input id="autoHardStopMin" type="number" min="1" step="1" value="2" class="input" aria-label="Hard stop minutes threshold" />
                            </div>
                        </div>
                    </div>
                    <!-- Geofence -->
                    <div class="admin-group">
                        <label class="toggle">
                            <input type="checkbox" id="geofenceToggle">
                            <span class="toggle-track"></span>
                            <span>Geofence</span>
                        </label>
                        <div class="admin-inputs">
                            <div class="admin-field">
                                <label class="label">Radius (m)</label>
                                <input id="geofenceRadius" type="number" min="100" step="100" value="1500" class="input" aria-label="Geofence radius in meters" />
                            </div>
                        </div>
                    </div>
                    <!-- Check-in -->
                    <div class="admin-group">
                        <label class="toggle">
                            <input type="checkbox" id="checkInToggle">
                            <span class="toggle-track"></span>
                            <span>I'm OK check-in</span>
                        </label>
                        <div class="admin-inputs">
                            <div class="admin-field">
                                <label class="label">Interval (min)</label>
                                <input id="checkInIntervalMin" type="number" min="1" step="1" value="5" class="input" aria-label="Check-in interval minutes" />
                            </div>
                            <div class="admin-field">
                                <label class="label">Overdue (min)</label>
                                <input id="checkInOverdueMin" type="number" min="1" step="1" value="7" class="input" aria-label="Overdue after minutes" />
                            </div>
                        </div>
                    </div>
                    <!-- Retention -->
                    <label class="toggle" style="margin-top:var(--space-2);">
                        <input type="checkbox" id="keepForeverToggle">
                        <span class="toggle-track"></span>
                        <span>Keep user forever (no purge)</span>
                    </label>
                    <!-- Apply -->
                    <button class="btn btn-primary btn-sm" id="adminApplyBtn" type="button" aria-label="Apply admin settings" style="margin-top:var(--space-3);width:100%;">Apply Settings</button>
                    <div class="text-xs text-muted" style="margin-top:var(--space-2);">Check-in rule: user must tap "I'm OK" at least every interval; if overdue, admin gets an alert.</div>
                </div>
            </div>
            <% } %>
        </div>
    </div>

    <!-- ═══ Users Panel (Left or Right) ═══════════════════════════════════ -->
    <div class="panel panel-left" id="usersPanel">
        <div class="panel-header">
            <div class="panel-title">Users & Measurement</div>
            <button class="btn btn-ghost btn-icon btn-sm panel-close" type="button" aria-label="Close users panel" data-close="users">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div class="panel-body" id="usersPanelBody">
            <div class="distance-display" id="distanceDisplay">
                <div class="text-xs uppercase font-semibold text-muted" style="margin-bottom:var(--space-2);">Distance Between Points</div>
                <div class="distance-row">
                    <span id="user1Name">-</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                    <span id="user2Name">-</span>
                    <span class="distance-value" id="userDistance">-</span>
                    <button class="btn btn-ghost btn-sm" id="clearSelection" type="button" style="color:var(--danger-500);">Clear</button>
                </div>
            </div>

            <div class="user-list">
                <p class="text-xs text-muted" style="margin-bottom:var(--space-2);">Click on two points to measure distance. Tap a user to focus on map.</p>
                <div id="otherUsers">
                    <p class="no-users">No other users online</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ Sharing Panel (Right) ═════════════════════════════════════════ -->
    <div class="panel panel-right ui-hidden" id="sharingPanel">
        <div class="panel-header">
            <div class="panel-title">Sharing</div>
            <button class="btn btn-ghost btn-icon btn-sm panel-close" type="button" aria-label="Close sharing panel" data-close="sharing">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div class="panel-body" id="sharingPanelBody">
            <!-- Share code block -->
            <div class="share-code-block">
                <div class="text-xs uppercase font-semibold text-muted">My Share Code</div>
                <div class="share-code-row">
                    <code class="share-code-value" id="myShareCode"><%= shareCode %></code>
                    <button class="btn btn-secondary btn-sm" id="copyShareCodeBtn" type="button" aria-label="Copy share code">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        Copy
                    </button>
                </div>
                <div id="myContactInfo" class="text-xs text-muted" style="margin-top:var(--space-1);">
                    <% if (userEmail) { %><span>Email: <strong><%= userEmail %></strong></span><% } %>
                    <% if (userMobile) { %><span>Mobile: <strong><%= userMobile %></strong></span><% } %>
                </div>
            </div>

            <hr class="divider">

            <!-- Rooms -->
            <div class="section-label">Rooms</div>
            <div id="roomsList"><p class="text-sm text-muted">No rooms yet</p></div>
            <div class="input-group" style="margin-top:var(--space-2);">
                <input type="text" id="roomNameInput" class="input" placeholder="Room name" aria-label="Room name">
                <button class="btn btn-primary btn-sm" id="createRoomBtn" type="button" aria-label="Create room">Create</button>
            </div>
            <div class="input-group" style="margin-top:var(--space-2);">
                <input type="text" id="joinRoomInput" class="input" placeholder="Room code" aria-label="Room code to join" style="text-transform:uppercase;">
                <button class="btn btn-secondary btn-sm" id="joinRoomBtn" type="button" aria-label="Join room">Join</button>
            </div>

            <hr class="divider">

            <!-- Contacts -->
            <div class="section-label">Contacts</div>
            <div id="contactsList"><p class="text-sm text-muted">No contacts yet</p></div>
            <div style="margin-top:var(--space-2);">
                <div class="text-xs text-muted" style="margin-bottom:var(--space-1);">Add by email or mobile:</div>
                <div class="input-group">
                    <input type="text" id="addContactByValueInput" class="input" placeholder="Email or mobile number" aria-label="Email or mobile to add contact">
                    <button class="btn btn-primary btn-sm" id="addContactByValueBtn" type="button" aria-label="Add contact by email or mobile">Add</button>
                </div>
            </div>
            <div style="margin-top:var(--space-2);">
                <div class="text-xs text-tertiary" style="margin-bottom:var(--space-1);">Or add by share code:</div>
                <div class="input-group">
                    <input type="text" id="addContactInput" class="input" placeholder="Share code" aria-label="Share code to add contact" style="text-transform:uppercase;">
                    <button class="btn btn-secondary btn-sm" id="addContactBtn" type="button" aria-label="Add contact by share code">Add</button>
                </div>
            </div>

            <hr class="divider">

            <!-- Live links -->
            <div class="section-label">Live Sharing</div>
            <p class="text-xs text-muted" style="margin-bottom:var(--space-2);">Generate a public link anyone can open (no login).</p>
            <div id="liveLinksList"><p class="text-sm text-muted">No active links</p></div>
            <div class="live-link-generate">
                <button class="btn btn-primary btn-sm" id="generateLinkBtn" type="button" aria-label="Generate a live sharing link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                    Generate Link
                </button>
                <div class="link-dropdown ui-hidden" id="linkDropdown">
                    <button class="link-option" type="button" data-duration="1h">1 hour</button>
                    <button class="link-option" type="button" data-duration="6h">6 hours</button>
                    <button class="link-option" type="button" data-duration="24h">24 hours</button>
                    <button class="link-option" type="button" data-duration="forever">Until I stop</button>
                </div>
            </div>

            <div id="sharingOnboarding" style="display:none;">
                <hr class="divider">
                <p class="text-xs text-muted" style="font-style:italic;">You're not sharing with anyone yet. Create a room or exchange share codes to start seeing others on the map.</p>
            </div>
        </div>
    </div>

    <!-- ═══ Floating Action Buttons (Bottom) ══════════════════════════════ -->
    <div class="fab-container">
        <button class="fab fab-secondary" id="resetButton" type="button" aria-label="Reset tracking data" title="Reset">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
        </button>
        <button class="fab fab-primary" id="trackButton" type="button" aria-label="Start or stop location tracking" title="Start Tracking">
            <svg class="fab-icon-start" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            <svg class="fab-icon-stop" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
        </button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/tracking.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
